\usepackage{listings}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{multicol}
\newcommand{\multicolsbreak}{\vfill\null\columnbreak}
\newenvironment{TwoColumn}{\begin{multicols}{2}}{\end{multicols}}

%\usepackage{stmaryrd}

\usepackage{mathpartir}
\mprset{sep=1em,andskip=1em}

% "sigplan" ... because original value was from \documentclass[sigplan]{acmart}
\newcommand{\sigplancolumnwidth}{184pt}
\newcommand{\sigplancolumnsep}{25pt}
\newcommand{\bigvspace}{\vspace{3ex}}

\newcommand{\twoline}[2]{\parbox[s]{1.8cm}{\flushright\hfill #1\\#2}}
\newcommand{\lblmathpar}[2]{\lblmathparextra{#1}{}{#2}}
\newcommand{\lblmathparextra}[3]{\parbox[t]{\columnwidth}{\fbox{#1}#2\\[-1ex]\begin{mathpar}#3\end{mathpar}}}
\newcommand{\lbl}[2]{\lblextra{#1}{}{#2}}
\newcommand{\lblextra}[3]{\parbox[t]{\columnwidth}{\fbox{#1}#2\\#3}}

% for wide rows in a table
\newcommand{\sidecond}[1]{\multicolumn{3}{l}{\mbox{\quad #1}}}
\newcommand{\mboxor}[1]{\mbox{ or #1}}

%% To show overfull, turn off for production
\overfullrule=1mm

%% -----------------------------------------------------------------------------
%% enable page numbers
%\settopmatter{printfolios=true}
\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% -----------------------------------------------------------------------------

\let\captionwidth\relax

\newcommand{\subt}{\mathrel{<:}}
\newcommand{\subteq}{\mathrel{\leqslant\kern-0.3em\raisebox{0.3ex}{:}}}
\newcommand{\subk}{\subt}
\newcommand{\subkeq}{\subteq}
\newcommand{\BNFeq}{=}
\newcommand{\eeq}{=}
\renewcommand{\qedsymbol}{\square}

%% -----------------------------------------------------------------------------
%% formatting Python code

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{8} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{8}  % for normal

% Custom colors
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
commentstyle=\fontfamily{tt},
otherkeywords={self},             % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=none,                         % Any extra options here
showstringspaces=false            % 
}}

% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[1]{{
\pythonstyle
\lstinputlisting{#1}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}

%% -----------------------------------------------------------------------------

\mathchardef\mhyphen="2D

\newcommand{\compilesto}{\rightsquigarrow}
\newcommand{\carrow}{\compilesto}
\newcommand{\context}{\mathcal{C}}
\newcommand{\floorof}[1]{\lfloor #1 \rfloor}
\newcommand{\tagof}[1]{\lfloor #1 \rfloor}
\newcommand{\config}[1]{\langle #1 \rangle}
\newcommand{\stepsto}{\rightarrow^*}
\newcommand{\blameset}{\mathcal{B}}
\newcommand{\blame}[1]{\textsc{Blame}(#1)}
\newcommand{\labels}{\mathcal{L}}
\newcommand{\dyncheck}[2]{#1 \Downarrow \config{#2, l , \respath}}
\newcommand{\fresh}[1]{\emph{fresh}(#1)}
\newcommand{\respath}{\textsc{Res}}

\newcommand{\integers}{\mathbb{Z}}
\newcommand{\naturals}{\mathbb{N}}

\newcommand{\assign}{:\!=}
\newcommand{\GammaD}{\Gamma}
\newcommand{\GammaS}{\Gamma}
\newcommand{\deltaD}{\delta_D}
\newcommand{\deltaS}{\delta_S}
\newcommand{\ED}{E}
\newcommand{\ES}{E}
\newcommand{\ctxD}[1]{\ED[#1]}
\newcommand{\ctxS}[1]{\ES[#1]}
\newcommand{\ctxE}[1]{E[#1]}
\newcommand{\ctxEp}[1]{E'[#1]}
\newcommand{\quinequote}[1]{\llbracket #1 \rrbracket}


\newcommand{\tnat}{\mathsf{Nat}}
\newcommand{\tint}{\mathsf{Int}}
\newcommand{\tbox}{\mathsf{Box}}
\newcommand{\tcross}{\times}
\newcommand{\tpair}[2]{#1\!\tcross\!#2}
\newcommand{\tlist}{\mathsf{List}}
\newcommand{\tarrow}{\rightarrow}
\newcommand{\tarr}[2]{#1 \tarrow #2}
\newcommand{\tunion}{\bigcup}
\newcommand{\tall}[2]{\forall\,#1.\,#2}
\newcommand{\trec}[2]{\mu\,#1.\,#2}
\newcommand{\tann}[2]{(#1\!:\!#2)}

\newcommand{\deltaC}{\vchk\mhyphen\mathsf{tag}}
\newcommand{\vdyn}{\mathsf{dyn}}
\newcommand{\vsta}{\mathsf{stat}}
\newcommand{\vchk}{\mathsf{check}}
\newcommand{\edyn}[2]{\vdyn~#1~#2}
\newcommand{\esta}[2]{\vsta~#1~#2}
\newcommand{\echk}[2]{\vchk~#1~#2}
\newcommand{\mchk}[2]{\quinequote{#2}_{#1}}

\newcommand{\arrSD}{\mathrel{\textsc{s}\!\!\Rightarrow\!\!\textsc{d}}}
\newcommand{\arrDS}{\mathrel{\textsc{d}\!\!\Rightarrow\!\!\textsc{s}}}
\newcommand{\wellSD}[3]{#1, #2 \arrSD #3}
\newcommand{\wellDS}[3]{#1, #2 \arrDS #3}

\newcommand{\fromsta}{\mathsf{static{\rightarrow}dynamic}}
\newcommand{\fromdyn}{\mathsf{dynamic{\rightarrow}static}}
\newcommand{\fromany}{\mathsf{check{\mhyphen}type}}

\newcommand{\kany}{\mathsf{Any}}
\newcommand{\kpair}{\mathsf{Pair}}
\newcommand{\kfun}{\mathsf{Fun}}
\newcommand{\kint}{\tint}
\newcommand{\knat}{\tnat}

\newcommand{\cclift}[2]{\mapsto_{#2}^{#1}}
\newcommand{\DSlift}[4]{#2~\bowtie_{#1}\,#4} % ignores argument 3
\newcommand{\vtuple}[2]{(#1, #2)}

\newcommand{\torigin}{\lozenge}
\newcommand{\uorigin}{\blacklozenge}

\newcommand{\rrR}{\mathrel{\textsc{r}}}
\newcommand{\rrRp}{\mathrel{\textsc{r}'}}
\newcommand{\rrfont}[1]{\mathbf{#1}}
\newcommand{\rrD}{\mathrel{\textsc{d}}}
\newcommand{\rrS}{\mathrel{\textsc{s}}}
\newcommand{\rrEE}{\mathrel{\textsc{e}}}
\newcommand{\rrND}{\mathrel{\textsc{d}_\rrfont{N}}}
\newcommand{\rrNS}{\mathrel{\textsc{s}_\rrfont{N}}}
\newcommand{\rrNE}{\mathrel{\textsc{n}}}
\newcommand{\rrCD}{\mathrel{\textsc{d}_\rrfont{C}}}
\newcommand{\rrCS}{\mathrel{\textsc{s}_\rrfont{C}}}
\newcommand{\rrCE}{\mathrel{\textsc{c}}}
\newcommand{\rrFD}{\mathrel{\textsc{d}_\rrfont{F}}}
\newcommand{\rrFS}{\mathrel{\textsc{s}_\rrfont{F}}}
\newcommand{\rrFE}{\mathrel{\textsc{f}}}
\newcommand{\rrKD}{\mathrel{\textsc{d}_\rrfont{K}}}
\newcommand{\rrKS}{\mathrel{\textsc{s}_\rrfont{K}}}
\newcommand{\rrKE}{\mathrel{\textsc{k}}}

\newcommand{\liftKD}{\cclift{E}{\rrKD}}
\newcommand{\liftKS}{\cclift{E}{\rrKS}}

\newcommand{\ccR}{\mathrel{\rightarrow_{\rrR}}}
\newcommand{\ccRp}{\mathrel{\rightarrow_{\rrRp}}}
\newcommand{\ccD}{\mathrel{\rightarrow_{\rrfont{D}}}}
\newcommand{\ccS}{\mathrel{\rightarrow_{\rrfont{S}}}}
\newcommand{\ccEE}{\mathrel{\rightarrow_{\rrfont{E}}}}
\newcommand{\ccND}{\mathrel{\rightarrow_{\rrfont{D_N}}}}
\newcommand{\ccNS}{\mathrel{\rightarrow_{\rrfont{S_N}}}}
\newcommand{\ccFD}{\mathrel{\rightarrow_{\rrfont{D_F}}}}
\newcommand{\ccFS}{\mathrel{\rightarrow_{\rrfont{S_F}}}}
\newcommand{\ccCD}{\mathrel{\rightarrow_{\rrfont{D_C}}}}
\newcommand{\ccCS}{\mathrel{\rightarrow_{\rrfont{S_C}}}}
\newcommand{\ccCE}{\mathrel{\rightarrow_{\rrfont{C}}}}
\newcommand{\ccFE}{\mathrel{\rightarrow_{\rrfont{F}}}}
\newcommand{\ccKD}{\mathrel{\rightarrow_{\rrfont{D_K}}}}
\newcommand{\ccKS}{\mathrel{\rightarrow_{\rrfont{S_K}}}}

\newcommand{\rastar}{\rightarrow^{*}}
\newcommand{\rrDstar}{\rastar_{\rrfont{D}}}
\newcommand{\rrSstar}{\rastar_{\rrfont{S}}}
\newcommand{\rrEEstar}{\rastar_{\rrfont{E}}}
\newcommand{\rrNEstar}{\rastar_{\rrfont{N}}}
\newcommand{\rrCEstar}{\rastar_{\rrfont{C}}}
\newcommand{\rrFEstar}{\rastar_{\rrfont{F}}}
\newcommand{\rrKEstar}{\rastar_{\rrfont{K}}}

\newcommand{\vfst}{\mathsf{fst}}
\newcommand{\vsnd}{\mathsf{snd}}
\newcommand{\vref}[1]{\textbf{ref}~#1}
\newcommand{\vlam}[2]{\lambda #1.\, #2}
\newcommand{\efst}[1]{\vfst\,#1}
\newcommand{\esnd}[1]{\vsnd\,#1}
\newcommand{\vpair}[2]{\langle #1,#2 \rangle}
\newcommand{\vapp}[2]{#1~#2}
\newcommand{\eapp}[2]{\vapp{#1}{#2}}
\newcommand{\vmon}[2]{\mathsf{mon}\,#1\,#2}
\newcommand{\vmonfun}[2]{\vmon{#1}{#2}}
\newcommand{\vmonpair}[2]{\vmon{#1}{#2}}
\newcommand{\vunop}{\emph{op}^1}
\newcommand{\vbinop}{\emph{op}^2}
\newcommand{\vbnd}{\emph{bnd}}
\newcommand{\vsum}{\mathsf{sum}}
\newcommand{\vquotient}{\mathsf{quotient}}

\newcommand{\vrel}[2]{#1 \models #2}
\newcommand{\vstate}[2]{[#1~#2]}
\newcommand{\vstategen}{\vstate{\sigma}{v}}
\newcommand{\vsubst}[3]{#1[#2\!\leftarrow\!#3]}

\newcommand{\tfun}[5]{\mathbf{fun} #1 (#2 : #3) \rightarrow #4\,.\,#5}
\newcommand{\ufun}[3]{\mathbf{fun} #1 (#2)\,.\,#3}

\newcommand{\ehole}{{[\,]}}
\newcommand{\holeD}{\ehole_D}
\newcommand{\holeS}{\ehole_S}

%% -----------------------------------------------------------------------------

\newcommand{\langD}{\mathbf{L_D}}
\newcommand{\langS}{\mathbf{L_S}}
\newcommand{\langM}{\mathbf{L}}
\newcommand{\langE}{\mathbf{L_E}}
\newcommand{\langN}{\mathbf{L_N}}
\newcommand{\langC}{\mathbf{L_C}}
\newcommand{\langL}{\langC}
\newcommand{\langF}{\mathbf{L_F}}
\newcommand{\langk}{\mathbf{L_k}}
\newcommand{\langK}{\mathbf{L_K}}

\newcommand{\stastep}{\rightarrow_S}
\newcommand{\dynstep}{\rightarrow_D}

\newcommand{\myvdash}[1]{\mathrel{\vdash\kern-0.8em{\raisebox{-0.7ex}{\textsc{\scriptsize #1}}}}}
\newcommand{\welldyn}{\myvdash{d}}
\newcommand{\wellsta}{\myvdash{s}}
\newcommand{\wellD}{\welldyn}
\newcommand{\wellS}{\wellsta}
\newcommand{\wellM}{\vdash}
\newcommand{\wellEE}{\myvdash{e}}
\newcommand{\wellNE}{\myvdash{n}}
\newcommand{\wellCE}{\myvdash{c}}
\newcommand{\wellLE}{\wellCE}
\newcommand{\wellFE}{\myvdash{f}}
\newcommand{\wellKE}{\myvdash{k}}
\newcommand{\tagerror}{\mathsf{TagError}}
\newcommand{\boundaryerror}{\mathsf{BoundaryError}}
\newcommand{\costDS}[1]{\mathbf{cost}_{DS}(#1)}
\newcommand{\costSD}[1]{\mathbf{cost}_{SD}(#1)}
\newcommand{\eunop}[1]{\vunop~#1}
\newcommand{\ebinop}[2]{\vbinop~#1~#2}
\newcommand{\esum}[2]{\vsum~#1~#2}
\newcommand{\equotient}[2]{\vquotient~#1~#2}

% for matching, in the reduction relations
\newcommand{\valeq}{=}
\newcommand{\expreq}{=}

\newcommand{\erelprime}{e_0}
\newcommand{\erelprimefull}{\eapp{(\vlam{\tann{x}{\tpair{\tint}{\tnat}}}{\vpair{\efst{x}}{\esnd{x}}})}{(\edyn{\tpair{\tint}{\tnat}}{(\esta{\tpair{\tnat}{\tnat}}{(\edyn{\tpair{\tnat}{\tnat}}{\vpair{-1}{-2}})})})}}
\newcommand{\erelprimefullcomplete}{\echk{\kpair}{\eapp{(\vlam{\tann{x}{\tpair{\tint}{\tnat}}}{\vpair{\echk{\kint}{(\efst{x})}}{\echk{\knat}{(\esnd{x})}}})}{(\edyn{\tpair{\tint}{\tnat}}{(\esta{\tpair{\tnat}{\tnat}}{(\edyn{\tpair{\tnat}{\tnat}}{\vpair{-1}{-2}})})})}}}
