\usepackage{listings}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathpartir}

%% -----------------------------------------------------------------------------
%% enable page numbers
%\settopmatter{printfolios=true}
\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% -----------------------------------------------------------------------------

% Override Scribble's default SecRef to numeric only
\renewcommand{\SecRef}[2]{#1}

\renewcommand{\vee}{\mbox{or}}

% For bib style
\newcommand{\Thyperref}[2]{\hyperref[#2]{#1}}

\let\captionwidth\relax

\newcommand{\subt}{\mathrel{<:}}
\newcommand{\subk}{\subt}
\newcommand{\subteq}{\mathrel{\leqslant:}}

%% -----------------------------------------------------------------------------
%% formatting Python code

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{8} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{8}  % for normal

% Custom colors
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
commentstyle=\fontfamily{tt},
otherkeywords={self},             % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=none,                         % Any extra options here
showstringspaces=false            % 
}}

% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[1]{{
\pythonstyle
\lstinputlisting{#1}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}

%% -----------------------------------------------------------------------------

\newcommand{\compilesto}{\rightsquigarrow}
\newcommand{\carrow}{\compilesto}
\newcommand{\context}{\mathcal{C}}
\newcommand{\floorof}[1]{\lfloor #1 \rfloor}
\newcommand{\tagof}[1]{\floorof{#1}}
\newcommand{\config}[1]{\langle #1 \rangle}
\newcommand{\stepsto}{\rightarrow^*}
\newcommand{\blameset}{\mathcal{B}}
\newcommand{\blame}[1]{\textsc{Blame}(#1)}
\newcommand{\labels}{\mathcal{L}}
\newcommand{\dyncheck}[2]{#1 \Downarrow \config{#2, l , \respath}}
\newcommand{\fresh}[1]{\emph{fresh}(#1)}
\newcommand{\respath}{\textsc{Res}}

\newcommand{\integers}{\mathbb{Z}}
\newcommand{\naturals}{\mathbb{N}}

\newcommand{\assign}{:\!=}
\newcommand{\GammaD}{\Gamma}
\newcommand{\GammaS}{\Gamma}
\newcommand{\deltaD}{\delta_D}
\newcommand{\deltaS}{\delta_S}

\newcommand{\tnat}{\mathsf{Nat}}
\newcommand{\tint}{\mathsf{Int}}
\newcommand{\tbox}{\mathsf{Box}}
\newcommand{\tpair}[2]{#1 \times #2}
\newcommand{\tlist}{\mathsf{List}}
\newcommand{\tarrow}{\rightarrow}
\newcommand{\tarr}[2]{#1 \tarrow #2}
\newcommand{\tunion}{\bigcup}
\newcommand{\tall}{\forall}
\newcommand{\tann}[2]{(#1\!:\!#2)}

\mathchardef\mhyphen="2D
\newcommand{\deltaC}{\vchk\mhyphen\mathsf{tag}}
\newcommand{\vdyn}{\mathsf{dynamic}}
\newcommand{\vsta}{\mathsf{static}}
\newcommand{\vchk}{\mathsf{check}}
\newcommand{\edyn}[2]{\vdyn~#1~#2}
\newcommand{\esta}[2]{\vsta~#1~#2}
\newcommand{\echk}[2]{\vchk~#1~#2}

\newcommand{\arrSD}{\mathrel{\textsc{s}\!\!\Rightarrow\!\!\textsc{d}}}
\newcommand{\arrDS}{\mathrel{\textsc{d}\!\!\Rightarrow\!\!\textsc{s}}}
\newcommand{\wellSD}[3]{#1, #2 \arrSD #3}
\newcommand{\wellDS}[3]{#1, #2 \arrDS #3}

\newcommand{\fromsta}{\mathsf{static{\rightarrow}dynamic}}
\newcommand{\fromdyn}{\mathsf{dynamic{\rightarrow}static}}

\newcommand{\kany}{\mathsf{Any}}
\newcommand{\kpair}{\mathsf{Pair}}
\newcommand{\kfun}{\mathsf{Fun}}
\newcommand{\kint}{\tint}
\newcommand{\knat}{\tnat}

\newcommand{\torigin}{\lozenge}
\newcommand{\uorigin}{\blacklozenge}

\newcommand{\rrD}{\mathrel{\textsc{d}}}
\newcommand{\rrS}{\mathrel{\textsc{s}}}
\newcommand{\rrEE}{\mathrel{\textsc{e}}}
\newcommand{\rrND}{\mathrel{\textsc{d}_N}}
\newcommand{\rrNS}{\mathrel{\textsc{s}_N}}
\newcommand{\rrNE}{\mathrel{\textsc{n}}}
\newcommand{\rrLD}{\mathrel{\textsc{d}_L}}
\newcommand{\rrLS}{\mathrel{\textsc{s}_L}}
\newcommand{\rrLE}{\mathrel{\textsc{c}}}
\newcommand{\rrFD}{\mathrel{\textsc{d}_F}}
\newcommand{\rrFS}{\mathrel{\textsc{s}_F}}
\newcommand{\rrFE}{\mathrel{\textsc{f}}}
\newcommand{\rrKD}{\mathrel{\textsc{d}_K}}
\newcommand{\rrKS}{\mathrel{\textsc{s}_K}}
\newcommand{\rrKE}{\mathrel{\textsc{k}}}

\newcommand{\ccD}{\mathrel{\rightarrow_{\rrD}}}
\newcommand{\ccS}{\mathrel{\rightarrow_{\rrS}}}
\newcommand{\ccEE}{\mathrel{\rightarrow_{\rrEE}}}
\newcommand{\ccND}{\mathrel{\rightarrow_{\rrND}}}
\newcommand{\ccNS}{\mathrel{\rightarrow_{\rrNS}}}
\newcommand{\ccLE}{\mathrel{\rightarrow_{\rrLE}}}
\newcommand{\ccFE}{\mathrel{\rightarrow_{\rrFE}}}
\newcommand{\ccKE}{\mathrel{\rightarrow_{\rrKE}}}

\newcommand{\rrDstar}{\rightarrow^{*}_{\rrD}}
\newcommand{\rrSstar}{\rightarrow^{*}_{\rrS}}
\newcommand{\rrEEstar}{\rightarrow^{*}_{\rrEE}}
\newcommand{\rrNEstar}{\rightarrow^{*}_{\rrNE}}
\newcommand{\rrLEstar}{\rightarrow^{*}_{\rrLE}}
\newcommand{\rrFEstar}{\rightarrow^{*}_{\rrFE}}
\newcommand{\rrKEstar}{\rightarrow^{*}_{\rrKE}}

\newcommand{\vevalD}{\mathsf{eval}_{\rrD}}
\newcommand{\vevalS}{\mathsf{eval}_{\rrS}}
\newcommand{\vevalEE}{\mathsf{eval}_{\rrEE}}
\newcommand{\vevalNE}{\mathsf{eval}_{\rrNE}}
\newcommand{\vevalLE}{\mathsf{eval}_{\rrLE}}
\newcommand{\vevalFE}{\mathsf{eval}_{\rrFE}}
\newcommand{\vevalKE}{\mathsf{eval}_{\rrKE}}

\newcommand{\vfst}{\mathsf{fst}}
\newcommand{\vsnd}{\mathsf{snd}}
\newcommand{\vref}[1]{\textbf{ref}~#1}
\newcommand{\vlam}[2]{\lambda #1.\, #2}
\newcommand{\efst}[1]{\vfst\,#1}
\newcommand{\esnd}[1]{\vsnd\,#1}
\newcommand{\vpair}[2]{\langle #1,#2 \rangle}
\newcommand{\vmon}[2]{\mathsf{mon}\,#1\,#2}
\newcommand{\vmonfun}[2]{\vmon{#1}{#2}}
\newcommand{\vmonpair}[2]{\vmon{#1}{#2}}
\newcommand{\vunop}{\emph{op}^1}
\newcommand{\vbinop}{\emph{op}^2}
\newcommand{\vbnd}{\emph{bnd}}
\newcommand{\vsum}{\mathsf{sum}}
\newcommand{\vquotient}{\mathsf{quotient}}

\newcommand{\vrel}[2]{#1 \models #2}
\newcommand{\vstate}[2]{[#1~#2]}
\newcommand{\vstategen}{\vstate{\sigma}{v}}
\newcommand{\vsubst}[3]{#1[#2\!\mapsto\!#3]}

\newcommand{\tfun}[5]{\mathbf{fun} #1 (#2 : #3) \rightarrow #4\,.\,#5}
\newcommand{\ufun}[3]{\mathbf{fun} #1 (#2)\,.\,#3}

%% value relation

%% -----------------------------------------------------------------------------

\newcommand{\langD}{\mathbf{L_D}}
\newcommand{\langS}{\mathbf{L_S}}
\newcommand{\langM}{\mathbf{L_M}}
\newcommand{\langE}{\mathbf{L_E}}
\newcommand{\langN}{\mathbf{L_N}}
\newcommand{\langL}{\mathbf{L_C}}
\newcommand{\langF}{\mathbf{L_F}}
\newcommand{\langK}{\mathbf{L_K}}

\newcommand{\stastep}{\rightarrow_S}
\newcommand{\dynstep}{\rightarrow_D}
\newcommand{\welldyn}{\vdash_D}
\newcommand{\wellsta}{\vdash_S}
\newcommand{\wellD}{\welldyn}
\newcommand{\wellS}{\wellsta}
\newcommand{\wellM}{\vdash}
\newcommand{\wellEE}{\vdash_E}
\newcommand{\wellNE}{\vdash_N}
\newcommand{\wellLE}{\vdash_C}
\newcommand{\wellFE}{\vdash_F}
\newcommand{\wellKE}{\vdash_K}
\newcommand{\typeerror}{\mathsf{TypeError}}
\newcommand{\valueerror}{\mathsf{BoundaryError}}
\newcommand{\bcost}[1]{\mathbf{C}(#1)}
\newcommand{\eunop}[1]{\vunop~#1}
\newcommand{\ebinop}[2]{\vbinop~#1~#2}

